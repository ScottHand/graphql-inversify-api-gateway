- Effect: Allow
  Action:
    - secretsmanager:GetSecretValue
  Resource:
    - "Fn::Join":
        - ""
        - - "arn:aws:secretsmanager:"
          - {Ref: "AWS::Region"}
          - ":"
          - {Ref: "AWS::AccountId"}
          - ":secret:*"

- Effect: Allow
  Action:
    - iam:CreateRole
    - iam:PutRolePolicy
    - lambda:CreateFunction
    - lambda:InvokeAsync
    - lambda:InvokeFunction
    - iam:PassRole
    - lambda:UpdateAlias
    - lambda:CreateAlias
    - lambda:GetFunctionConfiguration
    - lambda:AddPermission
    - lambda:UpdateFunctionCode
    - apigateway:PATCH # the function needs the apigateway:PATCH to eable detailed metrics
    - apigateway:GET # the function to get API name and REST end-points
    - cloudwatch:PutMetricAlarm # the function to create the alarms
  Resource: '*'

- Effect: Allow
  Action:
    - codecommit:*
    - codepipeline:*
    - codedeploy:*
  Resource: '*'
